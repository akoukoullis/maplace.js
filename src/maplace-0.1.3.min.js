!function($,t,o,i){"use strict";var s,e,n;s={activateCurrent:function(t){this.html_element.find("select").val(t)},getHtml:function(){var t=this,o="",i,s;if(this.ln>1){for(o+='<select class="dropdown controls '+this.o.controls_cssclass+'">',this.ShowOnMenu(this.view_all_key)&&(o+='<option value="'+this.view_all_key+'">'+this.o.view_all_text+"</option>"),s=0;s<this.ln;s+=1)this.ShowOnMenu(s)&&(o+='<option value="'+(s+1)+'">'+(this.o.locations[s].title||"#"+(s+1))+"</option>");o+="</select>",o=$(o).bind("change",function(){t.ViewOnMap(this.value)})}return i=this.o.controls_title,this.o.controls_title&&(i=$('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",fontSize:this.o.controls_on_map?"12px":"inherit",padding:"3px 10px 5px 0"}:{}).append(this.o.controls_title)),this.html_element=$('<div class="wrap_controls"></div>').append(i).append(o),this.html_element}},e={html_a:function(t,o,i){var s=this,e=o||t+1,n=i||this.o.locations[t].title,a=$('<a data-load="'+e+'" id="ullist_a_'+e+'" href="#'+e+'" title="'+n+'"><span>'+(n||"#"+(t+1))+"</span></a>");return a.css(this.o.controls_applycss?{color:"#666",display:"block",padding:"5px",fontSize:this.o.controls_on_map?"12px":"inherit",textDecoration:"none"}:{}),a.on("click",function(t){t.preventDefault();var o=$(this).attr("data-load");s.ViewOnMap(o)}),a},activateCurrent:function(t){this.html_element.find("li").removeClass("active"),this.html_element.find("#ullist_a_"+t).parent().addClass("active")},getHtml:function(){var t=$("<ul class='ullist controls "+this.o.controls_cssclass+"'></ul>").css(this.o.controls_applycss?{margin:0,padding:0,listStyleType:"none"}:{}),o,i;for(this.ShowOnMenu(this.view_all_key)&&t.append($("<li></li>").append(e.html_a.call(this,!1,this.view_all_key,this.o.view_all_text))),i=0;i<this.ln;i++)this.ShowOnMenu(i)&&t.append($("<li></li>").append(e.html_a.call(this,i)));return o=this.o.controls_title,this.o.controls_title&&(o=$('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",padding:"3px 10px 5px 0",fontSize:this.o.controls_on_map?"12px":"inherit"}:{}).append(this.o.controls_title)),this.html_element=$('<div class="wrap_controls"></div>').append(o).append(t),this.html_element}},n=function(){function t(t){this.VERSION="0.1.32",this.loaded=!1,this.markers=[],this.circles=[],this.oMap=!1,this.view_all_key="all",this.infowindow=null,this.ln=0,this.oMap=!1,this.oBounds=null,this.map_div=null,this.canvas_map=null,this.controls_wrapper=null,this.current_control=null,this.current_index=null,this.Polyline=null,this.Polygon=null,this.Fusion=null,this.directionsService=null,this.directionsDisplay=null,this.o={debug:!1,map_div:"#gmap",controls_div:"#controls",generate_controls:!0,controls_type:"dropdown",controls_cssclass:"",controls_title:"",controls_on_map:!0,controls_applycss:!0,controls_position:o.maps.ControlPosition.RIGHT_TOP,type:"marker",view_all:!0,view_all_text:"View All",pan_on_click:!0,start:0,locations:[],shared:{},map_options:{mapTypeId:o.maps.MapTypeId.ROADMAP},stroke_options:{strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.4},directions_options:{travelMode:o.maps.TravelMode.DRIVING,unitSystem:o.maps.UnitSystem.METRIC,optimizeWaypoints:!1,provideRouteAlternatives:!1,avoidHighways:!1,avoidTolls:!1},circle_options:{radius:100,visible:!0},styles:{},fusion_options:{},directions_panel:null,draggable:!1,editable:!1,show_infowindows:!0,show_markers:!0,infowindow_type:"bubble",listeners:{},beforeViewAll:function(){},afterViewAll:function(){},beforeShow:function(t,o,i){},afterShow:function(t,o,i){},afterCreateMarker:function(t,o,i){},beforeCloseInfowindow:function(t,o){},afterCloseInfowindow:function(t,o){},beforeOpenInfowindow:function(t,o,i){},afterOpenInfowindow:function(t,o,i){},afterRoute:function(t,o,i){},onPolylineClick:function(t){},onPolygonClick:function(t){},circleRadiusChanged:function(t,o,i){},circleCenterChanged:function(t,o,i){},drag:function(t,o,i){},dragEnd:function(t,o,i){},dragStart:function(t,o,i){}},this.AddControl("dropdown",s),this.AddControl("list",e),t&&"directions"===t.type&&(!t.show_markers&&(t.show_markers=!1),!t.show_infowindows&&(t.show_infowindows=!1)),$.extend(!0,this.o,t)}return t.prototype.controls={},t.prototype.create_objMap=function(){var t=this,i=0,s;for(s in this.o.styles)this.o.styles.hasOwnProperty(s)&&(0===i&&(this.o.map_options.mapTypeControlOptions={mapTypeIds:[o.maps.MapTypeId.ROADMAP]}),i++,this.o.map_options.mapTypeControlOptions.mapTypeIds.push("map_style_"+i));if(this.loaded)t.oMap.setOptions(this.o.map_options);else try{this.map_div.css({position:"relative",overflow:"hidden"}),this.canvas_map=$("<div>").addClass("canvas_map").css({width:"100%",height:"100%"}).appendTo(this.map_div),this.oMap=new o.maps.Map(this.canvas_map.get(0),this.o.map_options)}catch(e){this.debug("create_objMap::"+this.map_div.selector,e.toString())}this.o.styles.length>0&&(this.oMap.mapTypes.set("map_style_0",new o.maps.StyledMapType(this.o.styles,{name:"map_style_0"})),this.oMap.setMapTypeId("map_style_0"))},t.prototype.add_markers_to_objMap=function(){var t,o,i=this.o.type||"marker";switch(i){case"marker":for(t=0;t<this.ln;t++)o=this.create_objPoint(t),this.create.marker.call(this,t,o);break;default:this.create[i].apply(this)}},t.prototype.create_objPoint=function(t){var s=$.extend({},this.o.locations[t]),e=s.visible===i?i:s.visible;return!s.type&&(s.type=this.o.type),s.map=this.oMap,s.position=new o.maps.LatLng(s.lat,s.lon),s.zIndex=1e4,s.visible=e===i?this.o.show_markers:e,s.image&&(s.icon=new o.maps.MarkerImage(s.image,new o.maps.Size(s.image_w||32,s.image_h||32),new o.maps.Point(0,0),new o.maps.Point(image_w/2,image_h/2))),s},t.prototype.create_objCircle=function(t){var o,i,s;return s=$.extend({},t),o=$.extend({},this.o.stroke_options),i=$.extend({},this.o.circle_options),$.extend(o,t.stroke_options||{}),$.extend(s,o),$.extend(i,t.circle_options||{}),$.extend(s,i),s.center=t.position,s.draggable=!1,s.zIndex=9e3,s},t.prototype.add_markerEv=function(t,i,s){var e=this;o.maps.event.addListener(s,"click",function(o){e.o.beforeShow(t,i,s),!e.o.show_infowindows||(i.show_infowindow===!1?1:0)||e.open_infowindow(t,s,o),!e.o.pan_on_click||(i.pan_on_click===!1?1:0)||(e.oMap.panTo(i.position),i.zoom&&e.oMap.setZoom(i.zoom)),e.current_control&&e.o.generate_controls&&e.current_control.activateCurrent&&e.current_control.activateCurrent.call(e,t+1),e.current_index=t,e.o.afterShow(t,i,s)}),i.draggable&&this.add_dragEv(t,i,s)},t.prototype.add_circleEv=function(t,i,s){var e=this;o.maps.event.addListener(s,"click",function(){e.ViewOnMap(t+1)}),o.maps.event.addListener(s,"center_changed",function(){e.o.circleCenterChanged(t,i,s)}),o.maps.event.addListener(s,"radius_changed",function(){e.o.circleRadiusChanged(t,i,s)}),i.draggable&&this.add_dragEv(t,i,s)},t.prototype.add_dragEv=function(t,i,s){var e=this;o.maps.event.addListener(s,"drag",function(n){var a,r;if(s.getPosition)a=s.getPosition();else{if(!s.getCenter)return;a=s.getCenter()}if(e.circles[t]&&e.circles[t].setCenter(a),e.Polyline?r="Polyline":e.Polygon&&(r="Polygon"),r){for(var l=e[r].getPath(),h=l.getArray(),p=[],c=0;c<h.length;++c)p[c]=t===c?new o.maps.LatLng(a.lat(),a.lng()):new o.maps.LatLng(h[c].lat(),h[c].lng());e[r].setPath(new o.maps.MVCArray(p)),e.add_polyEv(r)}e.o.drag(t,i,s)}),o.maps.event.addListener(s,"dragend",function(){e.o.dragEnd(t,i,s)}),o.maps.event.addListener(s,"dragstart",function(){e.o.dragStart(t,i,s)}),o.maps.event.addListener(s,"center_changed",function(){e.markers[t]&&s.getCenter&&e.markers[t].setPosition(s.getCenter()),e.o.drag(t,i,s)})},t.prototype.add_polyEv=function(t){var i=this;o.maps.event.addListener(this[t].getPath(),"set_at",function(s,e){var n=i[t].getPath().getAt(s),a=new o.maps.LatLng(n.lat(),n.lng());i.markers[s]&&i.markers[s].setPosition(a),i.circles[s]&&i.circles[s].setCenter(a),i.o["on"+t+"Changed"](s,e,i[t].getPath().getArray())})},t.prototype.create={marker:function(t,i,s){var e=this,n;return"circle"!=i.type||s||(n=this.create_objCircle(i),i.visible||(n.draggable=i.draggable),s=new o.maps.Circle(n),this.add_circleEv(t,n,s),this.circles[t]=s),i.type="marker",s=new o.maps.Marker(i),this.add_markerEv(t,i,s),this.oBounds.extend(i.position),this.markers[t]=s,this.o.afterCreateMarker(t,i,s),s},circle:function(){var t=this,i,s,e,n;for(i=0;i<this.ln;i++)s=this.create_objPoint(i),"circle"==s.type&&(e=this.create_objCircle(s),s.visible||(e.draggable=s.draggable),n=new o.maps.Circle(e),this.add_circleEv(i,e,n),this.circles[i]=n),s.type="marker",this.create.marker.call(this,i,s,n)},polyline:function(){var t=this,i,s,e=$.extend({},this.o.stroke_options);for(e.path=[],e.draggable=this.o.draggable,e.editable=this.o.editable,e.map=this.oMap,e.zIndex=11e3,i=0;i<this.ln;i++)s=this.create_objPoint(i),this.create.marker.call(this,i,s),e.path.push(s.position);this.Polyline?this.Polyline.setOptions(e):this.Polyline=new o.maps.Polyline(e),this.add_polyEv("Polyline")},polygon:function(){var t=this,i,s,e=$.extend({},this.o.stroke_options);for(e.path=[],e.draggable=this.o.draggable,e.editable=this.o.editable,e.map=this.oMap,e.zIndex=11e3,i=0;i<this.ln;i++)s=this.create_objPoint(i),this.create.marker.call(this,i,s),e.path.push(s.position);this.Polygon?this.Polygon.setOptions(e):this.Polygon=new o.maps.Polygon(e),o.maps.event.addListener(this.Polygon,"click",function(o){t.o.onPolygonClick(o)}),this.add_polyEv("Polygon")},fusion:function(){this.o.fusion_options.styles=[this.o.stroke_options],this.o.fusion_options.map=this.oMap,this.Fusion?this.Fusion.setOptions(this.o.fusion_options):this.Fusion=new o.maps.FusionTablesLayer(this.o.fusion_options)},directions:function(){var t=this,i,s,e,n,a,r=[],l=0;for(i=0;i<this.ln;i++)s=this.create_objPoint(i),0===i?n=s.position:i===this.ln-1?a=s.position:(e=this.o.locations[i].stopover===!0?!0:!1,r.push({location:s.position,stopover:e})),this.create.marker.call(this,i,s);this.o.directions_options.origin=n,this.o.directions_options.destination=a,this.o.directions_options.waypoints=r,this.directionsService||(this.directionsService=new o.maps.DirectionsService),this.directionsDisplay?this.directionsDisplay.setOptions({draggable:this.o.draggable}):this.directionsDisplay=new o.maps.DirectionsRenderer({draggable:this.o.draggable}),this.directionsDisplay.setMap(this.oMap),this.o.directions_panel&&(this.o.directions_panel=$(this.o.directions_panel),this.directionsDisplay.setPanel(this.o.directions_panel.get(0))),this.o.draggable&&o.maps.event.addListener(this.directionsDisplay,"directions_changed",function(){l=t.compute_distance(t.directionsDisplay.directions),t.o.afterRoute(l)}),this.directionsService.route(this.o.directions_options,function(i,s){s===o.maps.DirectionsStatus.OK&&(l=t.compute_distance(i),t.directionsDisplay.setDirections(i)),t.o.afterRoute(l,s,i)})}},t.prototype.compute_distance=function(t){var o=0,i,s=t.routes[0],e=s.legs.length;for(i=0;e>i;i++)o+=s.legs[i].distance.value;return o},t.prototype.type_to_open={bubble:function(t){this.infowindow=new o.maps.InfoWindow({content:t.html||""})}},t.prototype.open_infowindow=function(t,o,i){this.CloseInfoWindow();var s=this.o.locations[t],e=this.o.infowindow_type;s.html&&this.type_to_open[e]&&(this.o.beforeOpenInfowindow(t,s,o),this.type_to_open[e].call(this,s),this.infowindow.open(this.oMap,o),this.o.afterOpenInfowindow(t,s,o))},t.prototype.get_html_controls=function(){return this.controls[this.o.controls_type]&&this.controls[this.o.controls_type].getHtml?(this.current_control=this.controls[this.o.controls_type],this.current_control.getHtml.apply(this)):""},t.prototype.generate_controls=function(){if(!this.o.controls_on_map)return this.controls_wrapper.empty(),void this.controls_wrapper.append(this.get_html_controls());var t=$('<div class="on_gmap '+this.o.controls_type+' gmap_controls"></div>').css(this.o.controls_applycss?{margin:"5px"}:{}),o=$(this.get_html_controls()).css(this.o.controls_applycss?{background:"#fff",padding:"5px",border:"1px solid rgb(113,123,135)",boxShadow:"rgba(0, 0, 0, 0.4) 0px 2px 4px",maxHeight:this.map_div.find(".canvas_map").outerHeight()-80,minWidth:100,overflowY:"auto",overflowX:"hidden"}:{});t.append(o),this.oMap.controls[this.o.controls_position].push(t.get(0))},t.prototype.init_map=function(){var t=this;this.Polyline&&this.Polyline.setMap(null),this.Polygon&&this.Polygon.setMap(null),this.Fusion&&this.Fusion.setMap(null),this.directionsDisplay&&this.directionsDisplay.setMap(null);for(var i=this.markers.length-1;i>=0;i-=1)try{this.markers[i]&&this.markers[i].setMap(null)}catch(s){t.debug("init_map::markers::setMap",s.stack)}this.markers.length=0,this.markers=[];for(var i=this.circles.length-1;i>=0;i-=1)try{this.circles[i]&&this.circles[i].setMap(null)}catch(s){t.debug("init_map::circles::setMap",s.stack)}this.circles.length=0,this.circles=[],this.o.controls_on_map&&this.oMap.controls&&this.oMap.controls[this.o.controls_position].forEach(function(o,i){try{t.oMap.controls[this.o.controls_position].removeAt(i)}catch(s){t.debug("init_map::removeAt",s.stack)}}),this.oBounds=new o.maps.LatLngBounds},t.prototype.perform_load=function(){1===this.ln?(this.o.map_options.set_center?this.oMap.setCenter(new o.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):(this.oMap.fitBounds(this.oBounds),this.ViewOnMap(1)),this.o.map_options.zoom&&this.oMap.setZoom(this.o.map_options.zoom)):0===this.ln?(this.o.map_options.set_center?this.oMap.setCenter(new o.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):this.oMap.fitBounds(this.oBounds),this.oMap.setZoom(this.o.map_options.zoom||1)):(this.oMap.fitBounds(this.oBounds),"number"==typeof(this.o.start-0)&&this.o.start>0&&this.o.start<=this.ln?this.ViewOnMap(this.o.start):this.o.map_options.set_center?this.oMap.setCenter(new o.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):this.ViewOnMap(this.view_all_key),this.o.map_options.zoom&&this.oMap.setZoom(this.o.map_options.zoom))},t.prototype.debug=function(t,o){return this.o.debug&&console.log(t,o),this},t.prototype.AddControl=function(t,o){return t&&o?(this.controls[t]=o,this):(self.debug("AddControl",'Missing "name" and "func" callback.'),!1)},t.prototype.CloseInfoWindow=function(){return this.infowindow&&(this.current_index||0===this.current_index)&&(this.o.beforeCloseInfowindow(this.current_index,this.o.locations[this.current_index]),this.infowindow.close(),this.infowindow=null,this.o.afterCloseInfowindow(this.current_index,this.o.locations[this.current_index])),this},t.prototype.ShowOnMenu=function(t){if(t===this.view_all_key&&this.o.view_all&&this.ln>1)return!0;if(t=parseInt(t,10),"number"==typeof(t-0)&&t>=0&&t<this.ln){var o=this.o.locations[t].on_menu===!1?!1:!0;if(o)return!0}return!1},t.prototype.ViewOnMap=function(t){if(t===this.view_all_key)this.o.beforeViewAll(),this.current_index=t,this.o.locations.length>0&&this.o.generate_controls&&this.current_control&&this.current_control.activateCurrent&&this.current_control.activateCurrent.apply(this,[t]),this.oMap.fitBounds(this.oBounds),this.CloseInfoWindow(),this.o.afterViewAll();else if(t=parseInt(t,10),"number"==typeof(t-0)&&t>0&&t<=this.ln)try{o.maps.event.trigger(this.markers[t-1],"click")}catch(i){this.debug("ViewOnMap::trigger",i.stack)}return this},t.prototype.SetLocations=function(t,o){return this.o.locations=t,o&&this.Load(),this},t.prototype.AddLocations=function(t,o){var i=this;return $.isArray(t)&&$.each(t,function(t,o){i.o.locations.push(o)}),$.isPlainObject(t)&&this.o.locations.push(t),o&&this.Load(),this},t.prototype.AddLocation=function(t,o,i){var s=this;return $.isPlainObject(t)&&this.o.locations.splice(o,0,t),i&&this.Load(),this},t.prototype.RemoveLocations=function(t,o){var i=this,s=0;return $.isArray(t)?$.each(t,function(t,o){o-s<i.ln&&i.o.locations.splice(o-s,1),s++}):t<this.ln&&this.o.locations.splice(t,1),o&&this.Load(),this},t.prototype.Loaded=function(){return this.loaded},t.prototype._init=function(){this.ln=this.o.locations.length;for(var t=0;t<this.ln;t++){var o=$.extend({},this.o.shared);this.o.locations[t]=$.extend(o,this.o.locations[t]),this.o.locations[t].html&&(this.o.locations[t].html=this.o.locations[t].html.replace("%index",t+1),this.o.locations[t].html=this.o.locations[t].html.replace("%title",this.o.locations[t].title||""))}return this.map_div=$(this.o.map_div),this.controls_wrapper=$(this.o.controls_div),this},t.prototype.Load=function(t){$.extend(!0,this.o,t),t&&t.locations&&(this.o.locations=t.locations),this._init(),this.o.visualRefresh===!1?o.maps.visualRefresh=!1:o.maps.visualRefresh=!0,this.init_map(),this.create_objMap(),this.add_markers_to_objMap(),this.ln>1&&this.o.generate_controls||this.o.force_generate_controls?(this.o.generate_controls=!0,this.generate_controls()):this.o.generate_controls=!1;var i=this;if(this.loaded)this.perform_load();else{o.maps.event.addListenerOnce(this.oMap,"idle",function(){i.perform_load()}),o.maps.event.addListener(this.oMap,"resize",function(){i.canvas_map.css({width:i.map_div.width(),height:i.map_div.height()})});var s;for(s in this.o.listeners){var e=this.oMap,n=this.o.listeners[s];this.o.listeners.hasOwnProperty(s)&&o.maps.event.addListener(this.oMap,s,function(t){n(e,t)})}}return this.loaded=!0,this},t}(),"function"==typeof define&&define.amd?define(function(){return n}):t.Maplace=n}(jQuery,this,google);